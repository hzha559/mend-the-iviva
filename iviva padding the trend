#example csv looks like
#,2022-08-04 03:30:00,2022-08-04 03:45:00,2022-08-04 04:00:00,2022-08-04 04:15:00,2022-08-04 04:30:00,2022-08-04 04:45:00,2022-08-04 05:00:00,2022-08-04 05:15:00,2022-08-04 05:30:00,2022-08-04 05:45:00,2022-08-04 06:00:00,2022-08-04 06:15:00,2022-08-04 06:30:00,2022-08-04 06:45:00,,,2022-08-04 07:30:00,2022-08-04 07:45:00,2022-08-04 08:00:00,2022-08-04 08:15:00,2022-08-04 08:30:00,2022-08-04 08:45:00,2022-08-04 09:00:00,2022-08-04 09:15:00,2022-08-04 09:30:00,2022-08-04 09:45:00,2022-08-04 10:00:00,2022-08-04 10:15:00,2022-08-04 10:30:00,2022-08-04 10:45:00,2022-08-04 11:00:00,2022-08-04 11:15:00,2022-08-04 11:30:00,2022-08-04 11:45:00,2022-08-04 12:00:00,2022-08-04 12:15:00,2022-08-04 12:30:00,2022-08-04 12:45:00,2022-08-04 13:00:00,2022-08-04 13:15:00,2022-08-04 13:30:00,2022-08-04 13:45:00,2022-08-04 14:00:00,2022-08-04 14:15:00,2022-08-04 14:30:00,2022-08-04 14:45:00,2022-08-04 15:00:00,2022-08-04 15:15:00,2022-08-04 15:30:00,2022-08-04 15:45:00,2022-08-04 16:00:00,2022-08-04 16:15:00,2022-08-04 16:30:00,2022-08-04 16:45:00,2022-08-04 17:00:00,2022-08-04 17:15:00,2022-08-04 17:30:00,2022-08-04 17:45:00,2022-08-04 18:00:00,2022-08-04 18:15:00,2022-08-04 18:30:00,2022-08-04 18:45:00,2022-08-04 19:00:00,2022-08-04 19:15:00,2022-08-04 19:30:00,2022-08-04 19:45:00,2022-08-04 20:00:00,2022-08-04 20:15:00,2022-08-04 20:30:00,2022-08-04 20:45:00,2022-08-04 21:00:00,2022-08-04 21:15:00,2022-08-04 21:30:00,2022-08-04 21:45:00,2022-08-04 22:00:00,2022-08-04 22:15:00,2022-08-04 22:30:00,2022-08-04 22:45:00,2022-08-04 23:00:00,2022-08-04 23:15:00,2022-08-04 23:30:00,2022-08-04 23:45:00,2022-08-05 00:00:00,2022-08-05 00:15:00,2022-08-05 00:30:00,2022-08-05 00:45:00,2022-08-05 01:00:00,2022-08-05 01:15:00,2022-08-05 01:30:00,2022-08-05 01:45:00,2022-08-05 02:00:00,2022-08-05 02:15:00,2022-08-05 02:30:00,2022-08-05 02:45:00,2022-08-05 03:00:00,2022-08-05 03:15:00,2022-08-05 03:30:00,2022-08-05 03:45:00,2022-08-05 04:00:00,2022-08-05 04:15:00,2022-08-05 04:30:00,2022-08-05 04:45:00,2022-08-05 05:00:00,2022-08-05 05:15:00,2022-08-05 05:30:00,2022-08-05 05:45:00,2022-08-05 06:00:00,2022-08-05 06:15:00,2022-08-05 06:30:00,2022-08-05 06:45:00,2022-08-05 07:00:00,2022-08-05 07:15:00,2022-08-05 07:30:00,2022-08-05 07:45:00,2022-08-05 08:00:00,2022-08-05 08:15:00,2022-08-05 08:30:00,2022-08-05 08:45:00,2022-08-05 09:00:00,2022-08-05 09:15:00,2022-08-05 09:30:00,2022-08-05 09:45:00,2022-08-05 10:00:00,2022-08-05 10:15:00,2022-08-05 10:30:00,2022-08-05 10:45:00,2022-08-05 11:00:00,2022-08-05 11:15:00,2022-08-05 11:30:00,,,2022-08-05 12:15:00,2022-08-05 12:30:00,2022-08-05 12:45:00,2022-08-05 13:00:00,2022-08-05 13:15:00,2022-08-05 13:30:00,2022-08-05 13:45:00,2022-08-05 14:00:00,2022-08-05 14:15:00,2022-08-05 14:30:00,2022-08-05 14:45:00,2022-08-05 15:00:00,2022-08-05 15:15:00,2022-08-05 15:30:00,2022-08-05 15:45:00,2022-08-05 16:00:00,2022-08-05 16:15:00,2022-08-05 16:30:00,2022-08-05 16:45:00,2022-08-05 17:00:00,2022-08-05 17:15:00,2022-08-05 17:30:00,2022-08-05 17:45:00,2022-08-05 18:00:00,2022-08-05 18:15:00,2022-08-05 18:30:00,2022-08-05 18:45:00,2022-08-05 19:00:00,2022-08-05 19:15:00,2022-08-05 19:30:00,2022-08-05 19:45:00,2022-08-05 20:00:00,2022-08-05 20:15:00,2022-08-05 20:30:00,2022-08-05 20:45:00,2022-08-05 21:00:00,2022-08-05 21:15:00,2022-08-05 21:30:00,2022-08-05 21:45:00,2022-08-05 22:00:00,2022-08-05 22:15:00,2022-08-05 22:30:00,2022-08-05 22:45:00,2022-08-05 23:00:00,2022-08-05 23:15:00,2022-08-05 23:30:00,2022-08-05 23:45:00,2022-08-06 00:00:00,2022-08-06 00:15:00,2022-08-06 00:30:00,2022-08-06 00:45:00,2022-08-06 01:00:00,2022-08-06 01:15:00,2022-08-06 01:30:00,2022-08-06 01:45:00,2022-08-06 02:00:00,2022-08-06 02:15:00,2022-08-06 02:30:00,2022-08-06 02:45:00,2022-08-06 03:00:00,2022-08-06 03:15:00,2022-08-06 03:30:00,2022-08-06 03:45:00,2022-08-06 04:00:00,2022-08-06 04:15:00,2022-08-06 04:30:00,2022-08-06 04:45:00,2022-08-06 05:00:00,2022-08-06 05:15:00,2022-08-06 05:30:00,2022-08-06 05:45:00,2022-08-06 06:00:00,2022-08-06 06:15:00,2022-08-06 06:30:00,2022-08-06 06:45:00,2022-08-06 07:00:00,,2022-08-06 07:30:00,2022-08-06 07:45:00,2022-08-06 08:00:00,2022-08-06 08:15:00,2022-08-06 08:30:00,2022-08-06 08:45:00,2022-08-06 09:00:00,2022-08-06 09:15:00,2022-08-06 09:30:00,2022-08-06 09:45:00,2022-08-06 10:00:00,2022-08-06 10:15:00,2022-08-06 10:30:00,2022-08-06 10:45:00,2022-08-06 11:00:00,,2022-08-06 11:30:00,2022-08-06 11:45:00,2022-08-06 12:00:00,2022-08-06 12:15:00,2022-08-06 12:30:00,2022-08-06 12:45:00,2022-08-06 13:00:00,2022-08-06 13:15:00,2022-08-06 13:30:00,2022-08-06 13:45:00,2022-08-06 14:00:00,2022-08-06 14:15:00,2022-08-06 14:30:00,2022-08-06 14:45:00,2022-08-06 15:00:00,2022-08-06 15:15:00,2022-08-06 15:30:00,2022-08-06 15:45:00,2022-08-06 16:00:00,2022-08-06 16:15:00,2022-08-06 16:30:00,2022-08-06 16:45:00,,2022-08-06 17:15:00,2022-08-06 17:30:00,2022-08-06 17:45:00,2022-08-06 18:00:00,2022-08-06 18:15:00,2022-08-06 18:30:00,2022-08-06 18:45:00,2022-08-06 19:00:00,2022-08-06 19:15:00,2022-08-06 19:30:00,2022-08-06 19:45:00,2022-08-06 20:00:00,2022-08-06 20:15:00,2022-08-06 20:30:00,2022-08-06 20:45:00,2022-08-06 21:00:00,2022-08-06 21:15:00,2022-08-06 21:30:00
#,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,,,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,,0,0,0,0,0,0,0,0,0,0,,,0,,0,0,0,,0,0,,0,0,,0,0

import pymssql
import csv
from dateutil import parser
query = '''SELECT PointValue,cast(TransactionDateTime at time zone 'UTC' at time zone 'AUS Eastern Standard Time' AS smalldatetime) AS TimeStamp
  FROM [IVIVAIBMSTrends_2022_08].[dbo].[IBMSTrends] t
  inner join [510cs].dbo.ibmspoints p on p.pointkey=t.pointkey
  inner join [510cs].dbo.ibmspointtemplates pt on p.PointTemplateKey=pt.PointTemplateKey
  inner join [510cs].dbo.AssetMaster a on a.AssetKey=p.AssetKey
  where assetid LIKE '%VAV-05-L7-01'
  and pointtemplatename in ('ActFlow')
  order by TransactionDateTime asc'''
query=query.replace('VAV-05-L7-01','CS-B-MECH-L10-PCHWP-R-02')
query=query.replace('ActFlow','Start_Stop')
#'Run_Status','Start_Stop')
conn=pymssql.connect(host='10.100.73.1', user='sa', password='@Lfas1',login_timeout=10)
cur = conn.cursor()
cur.execute(query)
result=cur.fetchall()
conn.close()


result1=['']
result2=['']
for i in range(len(result)-1):
    #result1.append([])
    #result2.append([])    
    date1 = parser.parse(str(result[i][1]))
    date2 = parser.parse(str(result[i+1][1]))
    diff = date2 - date1
    if diff.seconds<=800:#repeated trend
        print('here')
        continue
    else:
        result1.append(result[i][0])
        result2.append(str(result[i][1]))
    if diff.seconds>=1800:
        print(diff.seconds)
        #result1.append([])
        #result2.append([])
        loop=int(diff.seconds/60/15)
        loop+=diff.days*24*4
        print(loop)
        for j in range(loop-1):
            result1.append('')
            result2.append('')
print(len(result1))
print(len(result2))
v=open('trend1.csv','w')               
writer = csv.writer(v)
writer.writerow(result2)
writer.writerow(result1)                 
v.close()


